<!doctype html>
<html>
<head>

	<!-- Meta Tag -->
	<meta charset="utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="virapay" />
	<meta name="keywords" content="virapay, vira, pay" />
	<meta id="theme-color" name="theme-color" content="#ffffff">
	<meta name="yandex-verification" content="0e027f9006505dab" />

	<!-- Webfonts -->
	<link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap" rel="stylesheet" crossorigin="anonymous">
	<link href="https://cdn.materialdesignicons.com/5.0.45/css/materialdesignicons.min.css" rel="stylesheet" crossorigin="anonymous"/>

	<!-- UI framework -->
	<link href="css/typography.css" rel="stylesheet"/>

<!--    <link href="/css/colors.css" rel="stylesheet"/>
    <link href="/css/reset.css" rel="stylesheet"/>
	<link href="/css/typography.css" rel="stylesheet"/>
	<link href="/css/group.css" rel="stylesheet"/>-->

	<!-- Common -->
	<link href="css/common.css" rel="stylesheet"/>

	<!-- Core code -->
	<!--<script src="js/debug/output.js" type="text/javascript" charset="utf-8"></script>-->
	<script src="js/storage.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/JSONRPC2.js" type="text/javascript" charset="utf-8"></script>

	<!-- Google Sign In -->
    <script src="https://apis.google.com/js/platform.js"></script>

	<!-- Facebook API -->
	<script src="https://connect.facebook.net/en_US/sdk.js"></script>

	<!-- VK API -->
	<script src="https://vk.com/js/api/openapi.js?168" type="text/javascript"></script>

<style>

/* custom */

/*
html {
	font-family: 'Roboto', sans-serif;
    font-size: 14px;
}

body {
	margin: 0;
	color: #000;
	background-color: #ffffff;
}
*/

h1, h2, h3, h4, h5, h6 {
	font-family: inherit;
}

/*code {
	font-family: 'Ubuntu Mono', monospace;
}*/

.icon {
	font-size: 1.25em;
	display: inline-flex;
    align-items: center;
}

/* custom activities */

.activity.loading > .container {
	padding-bottom: 4rem;
}

.activity > .container > i.display1 {
	color: gainsboro;
	line-height: 10rem;
    font-size: 10rem;
}

.activity.login > .container {
	display: flex;
	flex-flow: column;
	align-items: center;
	justify-content: center;
}

.activity.login .logo {
	margin-bottom: 2rem;
}

.activity.login p {
    width: 20rem;
    font-size: 0.8rem;
}

.activity.profile {
	padding-top: 4rem;
}

.activity.profile .container {
	width: 100%;
	max-width: 40rem;
	align-items: center;
}

.activity.profile .avatar {
	width: 10rem;
	height: 10rem;
	border-radius: 50%;
}

.activity.profile h2, .activity.profile .avatar, .activity.profile .label, .activity.profile .button {
	margin-bottom: 2rem;
}

.activity.profile .info {
	max-width: 20em;
	border-top: 1px solid #eee;
	padding-top: 2rem;
}

.activity.profile .button.logout {
	margin-top: 2rem;
}


/* media */

@media (max-width: 767px) {
}

@media (min-width: 768px) {
}



/* buttons */

/*.button-auth {
	display: flex;
	align-items: center;
	justify-content: center;
	padding-left: 1rem;
	padding-right: 1rem;
	height: 2.5rem;
	width: 100%;
	max-width: 20rem;
	box-sizing: border-box;
	margin-bottom: 1rem;
	border: 0;
	border-radius: 0.25rem;
	background: #fff;
	box-shadow: 0.05rem 0.15rem 0 rgba(0,0,0,0.2);
	cursor: pointer;
}

.button-auth > .icon {
	height: 1.5rem;
	font-size: 1.5rem;
	margin-right: 0.5rem;
}

.button-auth > span {
	display: block;
	width: 100%;
	text-align: center;
	text-transform: uppercase;
}*/

.signin-with-google {
	border: 1px solid rgba(0,0,0,0.1);
}

.signin-with-facebook {
	color: #fff;
	background: rgb(24, 119, 242);
}

.signin-with-vk {
	color: #fff;
	background: #4c75a3;
}

/* utilities */

.is-hidden {
	display: none;
}

/*.wide {
	width: 100%;
}*/

.spin {
	animation: spin 0.3s linear infinite;	
}

@keyframes spin {
	from {
		transform: rotate(0deg);
	}
	to {
		transform: rotate(360deg);
	}
}











/*
.debug-console {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100vh;
    height: -webkit-fill-available;
	overflow: auto;
	z-index: 1000;
	box-sizing: border-box;
	padding: 1rem;
	font-size: 0.8rem;
}

.debug-console .output {
	margin: 0;
}
*/

</style>

</head>
<body>

<!--
	<div class="debug-console">
		<pre class="output"></pre>
	</div>
-->

	<div class="activity at-center loading">
		<div class="container">
			<i class="mdi mdi-loading display4 spin"></i>
		</div>
	</div>

	<div class="activity profile is-hidden">

		<div class="action-bar">
			<div class="container">
				<a class="icon mdi mdi-chevron-left logout"></a>
			</div>
		</div>

		<div class="container">

			<h2>Добро пожаловать!</h2>

<!--			<p><small><span class="apiname"></span>/<span class="id"></span></small></p>-->

			<img class="avatar"/>

			<label class="label">
				<div>Полное Имя</div>
				<div><input class="fullname"/></div>
			</label>

			<label class="label">
				<div>Email</div>
				<div><input class="email"/></div>
			</label>

			<button class="button primary profile-save">
	            <span>Продолжить</span>
				<i class="icon mdi mdi-arrow-right"></i>
			</button>

			<p class="info">Вы можете выйти в любое время. Если возникла такая необходимость, нажмите кнопку <q>Выход</q>.</p>

			<button class="button light logout">Выход</div>

		</div>
	</div>
<!--
	<div class="activity profile is-hidden">
		<div class="container tc">

			<img class="avatar"/>

			<p><small class="id">id</small></p>

			<label class="group vertical tl wide">
				Ваше имя
				<div class="group input">
					<div class="label"><i class="icon mdi mdi-account-outline"></i></div>
					<input type="text" class="fullname is-valid"/>
					<div class="validation">
						<i class="icon mdi mdi-check positive success"></i>
						<i class="icon mdi mdi-close negative error"></i>
					</div>
				</div>
				<p class="feedback">Введите ваше имя</p>
			</label>

			<label class="group vertical tl wide">
				Email
				<div class="group input">
					<div class="label"><i class="icon mdi mdi-at"></i></div>
					<input type="text" class="email is-valid"/>
					<div class="validation">
						<i class="icon mdi mdi-check positive success"></i>
						<i class="icon mdi mdi-close negative error"></i>
					</div>
				</div>
				<p class="feedback">Ваш действующий адрес эл. почты</p>
			</label>

			<button class="button logout">Выход</div>

		</div>
	</div>
-->
	<div class="activity at-center login is-hidden">

		<div class="container">

			<div class="logo vertical">
		        <img src="images/logo.svg"/>
		        <div><span>VIRA</span><span>PAY</span></div>
			</div>

			<button class="button -button-auth signin-with-google is-hidden">
	            <img class="icon" src="/images/google_g_logo.svg"/>
	            <span>Войти с Google</span>
			</button>

			<button class="button -button-auth signin-with-facebook is-hidden">
	            <!--<img class="icon" src="/images/facebook_f_logo.svg"/>-->
				<i class="icon mdi mdi-facebook"></i>
	            <span>Войти с Facebook</span>
			</button>

			<button class="button -button-auth signin-with-vk is-hidden">
	            <!--<img class="icon" src="/images/vk_logo.svg"/>-->
				<i class="icon mdi mdi-vk"></i>
	            <span>Войти с ВКонтакте</span>
			</button>

			<p>Нажимая кнопку, вы подтверждаете, что ознакомились с <a href="policy.html">политикой конфиденциальности</a>, даете согласие на обработку своих персональных данных и соглашаетесь с <a href="offer.html">условиями использования</a>.</p>

		</div>
	</div>
</body>
<script>

'use strict';

let isLoggedInWith = {
	google: undefined,
	facebook: undefined,
	vk: undefined
}

function isLoggedIn() {
	if (isLoggedInWith.google === undefined
	 || isLoggedInWith.facebook === undefined
	 || isLoggedInWith.vk === undefined) {
		return undefined
	}
	return isLoggedInWith.google || isLoggedInWith.facebook || isLoggedInWith.vk
}

function isLoggedOut() {
console.log('isLoggedOut()',isLoggedIn() === false)
	return isLoggedIn() === false
}

// activities

let activities = Array.from(document.querySelectorAll('.activity'))
let activityLogin = activities.reduce((_, a) => a.classList.contains('login') ? a : _, null)
let activityProfile = activities.reduce((_, a) => a.classList.contains('profile') ? a : _, null)

// activities switcher

function switchActivity(activity) {
	activities.forEach(a => a.classList.add('is-hidden'))
	activity.classList.remove('is-hidden')
}

// backend node

let backend = new JSONRPC2.RemoteProxyObject(
	// using JSON RPC over HTTP
	new JSONRPC2.Transports.HTTP(
		'https://powerful-taiga-14558.herokuapp.com/rpc/json',
		 {
			mode: 'cors'
		 }
	)
)

// profile functions

async function profileInit(apiName, id, fullName, imageUrl, email, token, logoutCallback) {

	try {
		console.log('VERIFICATION REQUEST', apiName, id, token)
		let result = await backend.verify(apiName, id, token)
		console.log('VERIFICATION', result)
	} catch (e) {
		console.log('VERIFICATION ERROR', e)
	}

	let profile = {
		id,
		apiName,
		imageUrl,
		fullName,
		email,
		token
	}

	activityProfile.querySelector('.avatar').src = imageUrl
//	activityProfile.querySelector('.apiname').innerText = apiName
//	activityProfile.querySelector('.id').innerText = id
	activityProfile.querySelector('.fullname').value = fullName
	activityProfile.querySelector('.email').value = email
//	activityProfile.querySelector('.token').innerText = token
	Array.prototype.forEach.call(activityProfile.querySelectorAll('.logout'), node => {
		node.onclick = logoutCallback
	})
	switchActivity(activityProfile)
}

</script>

	<!-- Auth -->
	<script src="js/login/google.js" type="text/javascript" charset="utf-8" async="true" defer="true"></script>
	<script src="js/login/facebook.js" type="text/javascript" charset="utf-8" async="true" defer="true"></script>
	<script src="js/login/vk.js" type="text/javascript" charset="utf-8" async="true" defer="true"></script>

	<!-- DEBUG -->
	<link href="css/debug/grid.css" rel="stylesheet"/>
	<script src="js/debug/grid.js" type="text/javascript" charset="utf-8"></script>

</html>