<!doctype html>
<html>
<head>

	<!-- Meta Tag -->
	<meta charset="utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="virapay" />
	<meta name="keywords" content="virapay, vira, pay" />
	<meta id="theme-color" name="theme-color" content="#ffffff">
	<meta name="yandex-verification" content="0e027f9006505dab" />

	<!-- Webfonts -->
	<link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap" rel="stylesheet" crossorigin="anonymous">
	<link href="https://cdn.materialdesignicons.com/5.0.45/css/materialdesignicons.min.css" rel="stylesheet" crossorigin="anonymous"/>

	<!-- UI framework -->
	<link href="css/typography.css" rel="stylesheet"/>

<!--    <link href="/css/colors.css" rel="stylesheet"/>
    <link href="/css/reset.css" rel="stylesheet"/>
	<link href="/css/typography.css" rel="stylesheet"/>
	<link href="/css/group.css" rel="stylesheet"/>-->

	<!-- Common -->
	<link href="css/common.css" rel="stylesheet"/>

	<!-- Core code -->
	<!--<script src="js/debug/output.js" type="text/javascript" charset="utf-8"></script>-->
	<script src="js/storage.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/JSONRPC2.js" type="text/javascript" charset="utf-8"></script>

	<!-- Google Sign In -->
    <script src="https://apis.google.com/js/platform.js"></script>

	<!-- Facebook API -->
	<script src="https://connect.facebook.net/en_US/sdk.js"></script>

	<!-- VK API -->
	<script src="https://vk.com/js/api/openapi.js?168" type="text/javascript"></script>

<style>

/* custom */

/*
html {
	font-family: 'Roboto', sans-serif;
    font-size: 14px;
}

body {
	margin: 0;
	color: #000;
	background-color: #ffffff;
}
*/

h1, h2, h3, h4, h5, h6 {
	font-family: inherit;
}

/*code {
	font-family: 'Ubuntu Mono', monospace;
}*/

.icon {
	font-size: 1.25em;
	display: inline-flex;
    align-items: center;
}

/* custom activities */

.activity.loading > .container {
	padding-bottom: 4rem;
}

.activity > .container > i.display1 {
	color: gainsboro;
	line-height: 10rem;
    font-size: 10rem;
}

.activity.login > .container {
	display: flex;
	flex-flow: column;
	align-items: center;
	justify-content: center;
}

.activity.login .logo {
	margin-bottom: 2rem;
}

.activity.login p {
    width: 20rem;
    font-size: 0.8rem;
}

.activity.profile {
	padding-top: 4rem;
}

.activity.profile .container {
	width: 100%;
	max-width: 40rem;
	align-items: center;
}

.activity.profile .avatar {
	width: 10rem;
	height: 10rem;
	border-radius: 50%;
}

.activity.profile h2, .activity.profile small, .activity.profile .label, .activity.profile .button {
	margin-bottom: 2rem;
}

.activity.profile .avatar {
	margin-bottom: 1rem;
}

.activity.profile .info {
	max-width: 20em;
	border-top: 1px solid #eee;
	padding-top: 2rem;
}

.activity.profile .button.logout {
	margin-top: 2rem;
}

.activity.message button {
	margin-top: 1rem;
}

.activity.main > .container {
	align-items: center;
	width: 100%;
	max-width: 30rem;
}

.activity.main .hot-icons {
	width: 100%;
	display: flex;
	flex-flow: row;
	justify-content: space-between;
	max-width: 27rem;
		background: #fff;
		border-radius: 10px;
    	box-shadow: 0 0 5rem rgba(0,0,0,0.2);
}

.bottom-panel {
	width: 100%;
	height: 6rem;
	position: fixed;
	bottom: 0;
	left: 0;
	z-index: 5;
	padding-left: 1rem;
	padding-right: 1rem;
	box-sizing: border-box;
	display: flex;
	align-items: center;
	justify-content: center;
	transition: bottom 0.3s ease-out;
}

.bottom-panel.hide {
	bottom: -6rem;
}

.activity.main .hot-icons a {
	padding: 1rem;
	display: flex;
	flex-flow: column;
	align-items: center;
	cursor: pointer;
	width: calc((100% - 2rem) / 3);
	height: 5rem;
	font-weight: bold;
	-webkit-tap-highlight-color: transparent;
}

.activity.main .hot-icons a .icon {
	font-size: 2rem;
}

.activity.main .hot-icons a span {
	font-size: 0.8rem;
}

.activity.main .hot-icons .open-favorites .icon {
	color: #fc0;
}

.activity.main .hot-icons .open-scanner .icon {
	color: #fd0000;
}

.activity.main .hot-icons .open-history .icon {
	color: #4a0;
}

.activity.main .hot-icons .open-search .icon {
	color: rgb(77, 144, 254);
}

.scroll-horizontal {
	overflow-x: hidden;
	max-width: 100%;
}

.activity.main .categories {
	display: flex;
    flex-flow: row;
    justify-content: space-between;
	box-sizing: border-box;
}

.activity.main .categories a {
    width: 6.5rem;
    min-width: 6.5rem;
    padding: 0.5rem;
    margin-bottom: 1rem;
    box-sizing: border-box;
    display: flex;
    flex-flow: column;
    align-items: center;
	border: 1px solid rgba(77, 144, 254, 0.2);
    box-shadow: 0 0 1rem rgba(0,0,0,0.1);
    border-radius: 5px;
    height: 6.5rem;
    cursor: pointer;
	margin-right: 1rem;
	user-select: none;
}

.activity.main .categories a .icon {
	font-size: 2rem;
	color: rgb(77, 144, 254);
	user-select: none;
}

.activity.main .categories a span {
	text-align: center;
	display: block;
	font-size: 0.8rem;
	user-select: none;
}

.activity.main .categories a.selected {
	background: rgb(77, 144, 254);
}

.activity.main .categories a.selected > * {
	color: #fff;
}

.activity.main .partners > .provider {

	flex-flow: row;
	justify-content: space-between;
	overflow: hidden;
	width: 100%;
	cursor: pointer;
	border-style: solid;
	border-color: #eee;
	box-sizing: border-box;

	animation-duration: 0.3s;
	animation-fill-mode: forwards;
	animation-name: provider-hide;

	padding-top: 0.5rem;
	padding-bottom: 0.5rem;
	border-width: 0;
	border-top-width: 1px;

	display: none;
	-webkit-tap-highlight-color: transparent;

		transition: margin-bottom 0.5s ease-out;
}

@keyframes provider-show {
  0% {
	transform: scale(1, 0);
	opacity: 0;
  }
  100% {
	transform: scale(1, 1);
	opacity: 1;
  }
}

@keyframes provider-hide {
  0% {
	transform: scale(1, 1);
	opacity: 1;
  }
  100% {
	transform: scale(1, 0);
	opacity: 0;
  }
}

.activity.main .partners > .provider.show {
	animation-name: provider-show;
	display: flex;
}

.activity.main .partners > .provider.hide {
	animation-name: provider-hide;
	display: flex;
}

.activity.main .partners > .provider .icon {
	width: 3rem;
	font-size: 1.5rem;
	justify-content: center;
	transition: color 0.3s ease-out;
	-webkit-tap-highlight-color: transparent;
}

.activity.main .partners {
	width: 100%;
	padding-bottom: 40rem;
	margin-top: 1rem;
}

.activity.main .partners > .provider .details {
	width: calc(100% - 3rem * 2);
}

.activity.main .partners > .provider .name {
	font-weight: bold;
}

.activity.main .partners > .provider .inn {
	opacity: 0.7;
	font-weight: 300;
}

.activity.main .partners > .provider .service {
	opacity: 0.7;
	font-weight: 300;
}

.activity.main .partners > .provider .icon.selected {
	color: rgb(77, 144, 254);
}


.activity.main .profile-show {
	display: flex;
	align-items: center;
	cursor: pointer;
	border-radius: 2rem;
	box-shadow: 0 0 1rem rgba(0,0,0,0.1);
	-webkit-tap-highlight-color: transparent;
}

.activity.main .avatar {
	width: 2.5rem;
	height: 2.5rem;
	border-radius: 50%;
	margin-right: 0.5rem;
	/*margin-left: 0.1rem;
	margin-top: 0.1rem;
	margin-bottom: 0.1rem;*/
}

.activity.main .fullname {
    margin-right: 1rem;
    max-width: 8rem;
    white-space: nowrap;
    display: inline-block;
    text-overflow: ellipsis;
    overflow: hidden;
}

.activity h5 {
	margin-top: 2rem;
	margin-bottom: 1rem;
}




.activity.navbar {
	background: rgba(255,255,255,0.75);
	padding-top: 4rem;
	/*display: flex;
	flex-flow: column;
	align-items: center;
	justify-content: center;*/
	z-index: 10;
}

.activity.navbar .links {
	margin-top: 4rem;
	background: #fff;
	padding: 1rem;
	border-radius: 10px;
}

.activity.navbar .links a {
	margin: 1rem;
	font-size: 1.25rem;
	cursor: pointer;
	font-weight: bold;
	display: block;
	text-decoration: none;
	color: inherit;
}

.activity.main .profile-show {
	z-index: 11;
}



/* media */

@media (max-width: 767px) {
}

@media (min-width: 768px) {
}



/* buttons */

/*.button-auth {
	display: flex;
	align-items: center;
	justify-content: center;
	padding-left: 1rem;
	padding-right: 1rem;
	height: 2.5rem;
	width: 100%;
	max-width: 20rem;
	box-sizing: border-box;
	margin-bottom: 1rem;
	border: 0;
	border-radius: 0.25rem;
	background: #fff;
	box-shadow: 0.05rem 0.15rem 0 rgba(0,0,0,0.2);
	cursor: pointer;
}

.button-auth > .icon {
	height: 1.5rem;
	font-size: 1.5rem;
	margin-right: 0.5rem;
}

.button-auth > span {
	display: block;
	width: 100%;
	text-align: center;
	text-transform: uppercase;
}*/

.signin-with-google {
	border: 1px solid rgba(0,0,0,0.1);
}

.signin-with-facebook {
	color: #fff;
	background: rgb(24, 119, 242);
}

.signin-with-vk {
	color: #fff;
	background: #4c75a3;
}

/* utilities */

.is-hidden {
	display: none;
}

/*.wide {
	width: 100%;
}*/

.spin {
	animation: spin 0.3s linear infinite;	
}

@keyframes spin {
	from {
		transform: rotate(0deg);
	}
	to {
		transform: rotate(360deg);
	}
}











/*
.debug-console {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100vh;
    height: -webkit-fill-available;
	overflow: auto;
	z-index: 1000;
	box-sizing: border-box;
	padding: 1rem;
	font-size: 0.8rem;
}

.debug-console .output {
	margin: 0;
}
*/

</style>

</head>
<body>

<!--
	<div class="debug-console">
		<pre class="output"></pre>
	</div>
-->

	<div class="activity at-center loading -is-hidden">
		<div class="container">
			<i class="mdi mdi-loading display4 spin"></i>
		</div>
	</div>

	<div class="activity at-center message is-hidden">
		<div class="container">
			<h2 class="title"></h2>
			<p>
				<i class="icon mdi mdi-alert-outline"></i>
				<span class="text"></span>
			</p>
			<button class="button primary action">
	            <span>Продолжить</span>
				<i class="icon mdi mdi-arrow-right"></i>
			</button>
		</div>
	</div>

	<div class="activity profile is-hidden">

		<div class="action-bar">
			<div class="container">
				<a class="icon mdi mdi-chevron-left back"></a>
			</div>
		</div>

		<div class="container">

			<h2>Добро пожаловать!</h2>

			<img class="avatar"/>

			<small><span class="apiname"></span>/<span class="id"></span></small>

			<label class="label">
				<div>Полное Имя</div>
				<div><input class="fullname"/></div>
			</label>

			<label class="label">
				<div>Email</div>
				<div><input class="email"/></div>
			</label>

			<button class="button primary profile-save">
	            <span>Продолжить</span>
				<i class="icon mdi mdi-arrow-right"></i>
			</button>

			<p class="info">Вы можете выйти в любое время. Если возникла такая необходимость, нажмите кнопку <q>Выход</q>.</p>

			<button class="button light logout">Выход</button>

		</div>
	</div>

<style>

.activity.accounts {
	padding-top: 4rem;
	padding-bottom: 40rem;
}

.activity.accounts .container {
	max-width: 26rem;
	width: 100%;
	align-items: center;
}

.activity.accounts .provider-details {
	margin-bottom: 1rem;
	width: 100%;
}

.activity.accounts .accounts-list {
	width: 100%;
}

.activity.accounts .provider-details .name {
	font-weight: bold;
	font-size: 1.25rem;
    margin-bottom: 1rem;
	width: 100%;
}

.activity.accounts .account {
	margin-top: 1rem;
	margin-bottom: 1rem;
	border: 1px solid rgba(77, 144, 254, 0.2);
    box-shadow: 0 0 1rem rgba(0,0,0,0.1);
    border-radius: 5px;
	background: #fff;
	z-index: 0;
	width: 100%;
}

.activity.accounts .account .description {
	opacity: 0.5;
}

.activity.accounts .account .value {
	font-size: 2.5rem;
	font-weight: 600;
	line-height: 1;
	margin: 0;
}

.activity.accounts .account .button-container {
    display: flex;
    flex-flow: row;
	justify-content: flex-end;
	width: 100%;
}

.activity.accounts .account .button-container button {
	width: 100%;
	max-width: 100%;
    color: rgb(24, 119, 242);
    margin: 0 0 0 0;
    box-shadow: none;
	background-color: rgba(215, 231, 251, 0.3);
	transition: background-color 0.3s ease-out;
}

.activity.accounts .account .button-container button:hover {
	background-color: rgba(215, 231, 251, 1);
}

.activity.accounts > .container > .button-container {
	display: flex;
	flex-flow: row;
	justify-content: center;
	margin-top: 2rem;
	margin-bottom: 2rem;
}

.activity.accounts .button-container button {
	margin: 0;
}

.activity.accounts .account .details {
	display: flex;
	flex-flow: row;
	padding: 0.5rem;
	align-items: start;
}

.activity.accounts .account .details .info {
	width: calc(100% - 2rem);
}

.activity.accounts .account .details .commands {
	width: 1.5rem;
}

.activity.accounts .account .details .popup-trigger {
	width: 2rem;
	height: 1.5rem;
	line-height: 1.5;
	cursor: pointer;
	display: block;
	text-align: center;
	-webkit-tap-highlight-color: transparent;
	border-top-left-radius: 5px;
	border-top-right-radius: 5px;
	user-select: none;
}

.activity.accounts .account .details .popup-trigger.is-active {
	background-color: #fff;
    box-shadow: 0 -0.5rem 1rem rgba(0,0,0,0.1);
    z-index: 2;
    position: relative;
}

.activity.accounts .account .details .popup-trigger + .popup {
	position: absolute;
	z-index: 1;
	width: 11rem;
	max-height: 0;
	margin-left: -9rem;
	background-color: #fff;
	box-shadow: 0 0 1rem rgba(0,0,0,0.1);
	display: inline-flex;
	flex-flow: column;
	box-sizing: border-box;
	overflow: hidden;
	transition: all 0.3s ease-out;
	opacity: 0;
	border-top-left-radius: 5px;
	border-bottom-left-radius: 5px;
	border-bottom-right-radius: 5px;
}

.activity.accounts .account .details .popup-trigger.is-active + .popup {
	max-height: 10rem;
	opacity: 1;
	box-shadow: 0 0 5rem rgba(0,0,0,0.3);
}

.activity.accounts .account .details .popup-trigger + .popup > a {
	display: block;
	padding: 0.5rem 1rem;
	cursor: pointer;
	transition: all 0.3s ease-out;
	user-select: none;
	-webkit-tap-highlight-color: transparent;
}

.activity.accounts .account .details .popup-trigger + .popup > a:hover {
	background-color: rgba(215, 231, 251, 0.7);
}

</style>

	<div class="activity accounts is-hidden">

		<div class="action-bar">
			<div class="container">
				<a class="icon mdi mdi-chevron-left back"></a>
			</div>
		</div>

		<div class="container">

			<div class="provider-details">
				<div class="name">Интеркомтел ООО </div>
				<div class="inn">ИНН 3702087103</div>
				<div class="service">Междугородняя/международная связь ВымпелКом</div>
			</div>

			<div class="accounts-list">
<!--
				<div class="account ex-1">
					<div class="details">
						<div class="info">
							<div class="name"><span class="acc-name">Лицевой счет</span></div>
							<div class="value">1892123123</div>
							<div class="description">Телефон в квартире на Куконковых</div>
						</div>
						<div class="commands">
							<i class="icon mdi mdi-dots-vertical popup-trigger"></i>
							<div class="popup">
								<a class="account-delete">Удалить</a>
								<a class="account-edit">Изменить</a>
								<a class="account-payment">Перейти к оплате</a>
							</div>
						</div>					
					</div>
					<div class="button-container">
						<button class="button">
				            <span>Перейти к оплате</span>
							<i class="icon mdi mdi-arrow-right"></i>
						</button>
					</div>
				</div>

				<div class="account ex-2">
					<div class="details">
						<div class="info">
							<div class="name"><span class="acc-name">Лицевой счет</span></div>
							<div class="value">1892</div>
							<div class="description">Мамин счет на оплату тепловой энергии</div>
						</div>
						<div class="commands">
							<i class="icon mdi mdi-dots-vertical popup-trigger"></i>
							<div class="popup">
								<a class="account-delete">Удалить</a>
								<a class="account-edit">Изменить</a>
								<a class="account-payment">Перейти к оплате</a>
							</div>
						</div>					
					</div>
					<div class="button-container">
						<button class="button">
				            <span>Перейти к оплате</span>
							<i class="icon mdi mdi-arrow-right"></i>
						</button>
					</div>
				</div>

				<div class="account ex-3">
					<div class="details">
						<div class="info">
							<div class="name"><span class="acc-name">Лицевой счет</span></div>
							<div class="value">1892123123</div>
							<div class="description">Телефон в квартире на Куконковых</div>
						</div>
						<div class="commands">
							<i class="icon mdi mdi-dots-vertical popup-trigger"></i>
							<div class="popup">
								<a class="account-delete">Удалить</a>
								<a class="account-edit">Изменить</a>
								<a class="account-payment">Перейти к оплате</a>
							</div>
						</div>					
					</div>
					<div class="button-container">
						<button class="button">
				            <span>Перейти к оплате</span>
							<i class="icon mdi mdi-arrow-right"></i>
						</button>
					</div>
				</div>

				<div class="account ex-4">
					<div class="details">
						<div class="info">
							<div class="name"><span class="acc-name">Лицевой счет</span></div>
							<div class="value">1892</div>
							<div class="description">Мамин счет на оплату тепловой энергии</div>
						</div>
						<div class="commands">
							<i class="icon mdi mdi-dots-vertical popup-trigger"></i>
							<div class="popup">
								<a class="account-delete">Удалить</a>
								<a class="account-edit">Изменить</a>
								<a class="account-payment">Перейти к оплате</a>
							</div>
						</div>					
					</div>
					<div class="button-container">
						<button class="button">
				            <span>Перейти к оплате</span>
							<i class="icon mdi mdi-arrow-right"></i>
						</button>
					</div>
				</div>

				<div class="account ex-5">
					<div class="details">
						<div class="info">
							<div class="name"><span class="acc-name">Лицевой счет</span></div>
							<div class="value">1892123123</div>
							<div class="description">Телефон в квартире на Куконковых</div>
						</div>
						<div class="commands">
							<i class="icon mdi mdi-dots-vertical popup-trigger"></i>
							<div class="popup">
								<a class="account-delete">Удалить</a>
								<a class="account-edit">Изменить</a>
								<a class="account-payment">Перейти к оплате</a>
							</div>
						</div>					
					</div>
					<div class="button-container">
						<button class="button">
				            <span>Перейти к оплате</span>
							<i class="icon mdi mdi-arrow-right"></i>
						</button>
					</div>
				</div>
-->
			</div>

			<div class="button-container">
				<button class="button primary account-add">
					<i class="icon mdi mdi-plus"></i>
	    	        <span>Добавить <span class="acc-name">Лицевой счет</span></span>
				</button>
			</div>

		</div>
	</div>




<style>

.activity.account-edit .container {
	align-items: center;
	max-width: 26rem;
	width: 100%;
}

.activity.account-edit {
	padding-top: 4rem;
	padding-bottom: 40rem;
}

.activity.account-edit .provider-details {
	margin-bottom: 1rem;
	width: 100%;
}

.activity.account-edit .provider-details .name {
	font-weight: bold;
	font-size: 1.25rem;
    margin-bottom: 1rem;
}

.activity.account-edit .label {
	margin-top: 1rem;
	margin-bottom: 1rem;
	width: 100%;
	max-width: 26rem;
}

.activity.account-edit .hint {
	font-weight: 100;
}

.activity.account-edit .button-container {
	margin-top: 1rem;
	width: 100%;
}

.activity.account-edit .button-container button {
	min-width: 100%;
}

</style>


	<div class="activity account-edit is-hidden">

		<div class="action-bar">
			<div class="container">
				<a class="icon mdi mdi-chevron-left back"></a>
			</div>
		</div>

		<div class="container">

			<div class="provider-details">
				<div class="name">Интеркомтел ООО </div>
				<div class="inn">ИНН 3702087103</div>
				<div class="service">Междугородняя/международная связь ВымпелКом</div>
			</div>

			<label class="label">
				<div class="acc-name">Лицевой счет</div>
				<div><input class="account"/></div>
				<div class="hint"><span class="acc-description">Номер лицевого счета вида X-Y.</span></div>
				<div class="hint">Например <span class="acc-example">123456789-123</span></div>
			</label>

			<label class="label">
				<div>Описание</div>
				<div><input class="description"/></div>
				<div class="hint">Краткое описание для вашего удобства</div>
			</label>

			<div class="button-container">
				<button class="button primary account-save">
	    	        <span>Сохранить</span>
					<i class="icon mdi mdi-arrow-right"></i>
				</button>
			</div>

		</div>
	</div>







<style>

.activity.account-add .container {
	align-items: center;
	width: 100%;
	max-width: 26rem;
}

.activity.account-add {
	padding-top: 4rem;
	padding-bottom: 40rem;
}

.activity.account-add .provider-details {
	margin-bottom: 1rem;
	width: 100%;
}

.activity.account-add .provider-details .name {
	font-weight: bold;
	font-size: 1.25rem;
    margin-bottom: 1rem;
}

.activity.account-add .label {
	margin-top: 1rem;
	margin-bottom: 1rem;
	width: 100%;
	max-width: 26rem;
}

.activity.account-add .hint {
	font-weight: 100;
}

.activity.account-add .button-container {
	margin-top: 1rem;
	width: 100%;
}

.activity.account-add .button-container button {
	min-width: 100%;
}

</style>


	<div class="activity account-add is-hidden">

		<div class="action-bar">
			<div class="container">
				<a class="icon mdi mdi-chevron-left back"></a>
			</div>
		</div>

		<div class="container">

			<div class="provider-details">
				<div class="name">Интеркомтел ООО </div>
				<div class="inn">ИНН 3702087103</div>
				<div class="service">Междугородняя/международная связь ВымпелКом</div>
			</div>

			<label class="label">
				<div class="acc-name">Лицевой счет</div>
				<div><input class="account"/></div>
				<div class="hint"><span class="acc-description">Номер лицевого счета вида X-Y.</span></div>
				<div class="hint">Например <span class="acc-example">123456789-123</span></div>
			</label>

			<label class="label">
				<div>Описание</div>
				<div><input class="description"/></div>
				<div class="hint">Краткое описание для вашего удобства</div>
			</label>

			<label class="label">
				<div>Сумма в рублях</div>
				<div><input class="summ" value="500.00"/></div>
				<div class="hint">Сумма к перечислению</div>
			</label>

			<label class="label">
				<div>Сервисный сбор: <span class="commision">5.00</span> руб.</div>
				<div>Итого: <span class="total">505.00</span> руб.</div>
			</label>

			<div class="button-container">
				<button class="button primary prepare-payment">
	    	        <span>Оплатить</span>
					<i class="icon mdi mdi-arrow-right"></i>
				</button>
			</div>

		</div>
	</div>





	<div class="activity navbar is-hidden">

		<div class="action-bar">
			<div class="container">
				<a class="icon mdi mdi-chevron-left back"></a>
			</div>
		</div>

		<div class="container">
			<div class="links">
				<a class="profile-show">Профиль пользователя</a>
				<a class="open-history">История операций</a>
				<a href="/policy.html">Политика конфиденциальности</a>
				<a href="/offer.html">Условия использования</a>
			</div>
		</div>

	</div>

	<div class="activity at-center login is-hidden">

		<div class="container">

			<div class="logo vertical">
		        <img src="images/logo.svg"/>
		        <div><span>VIRA</span><span>PAY</span></div>
			</div>

			<a class="button -button-auth signin-with-google" href="https://accounts.google.com/o/oauth2/auth?response_type=code&access_type=offline&client_id=272693258954-aj3mqp6l3kd9a5brhsf99k11bo0gd95i.apps.googleusercontent.com&redirect_uri=https%3A%2F%2Fvirapay.ru%2Fgoogle.html&state&scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.email%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.profile&approval_prompt=auto">
	            <img class="icon" src="/images/google_g_logo.svg"/>
	            <span>Войти с Google</span>
			</a>

			<a class="button -button-auth signin-with-facebook" href="https://www.facebook.com/v7.0/dialog/oauth?client_id=2682741668715941&redirect_uri=https://virapay.ru/facebook.html&state=fb">
	            <!--<img class="icon" src="/images/facebook_f_logo.svg"/>-->
				<i class="icon mdi mdi-facebook"></i>
	            <span>Войти с Facebook</span>
			</a>

			<a class="button -button-auth signin-with-vk" href="https://oauth.vk.com/authorize?client_id=7498783&display=page&scope=email,offline&response_type=code&v=5.120&state=vk&redirect_uri=https://virapay.ru/vk.html">
	            <!--<img class="icon" src="/images/vk_logo.svg"/>-->
				<i class="icon mdi mdi-vk"></i>
	            <span>Войти с ВКонтакте</span>
			</a>

			<p>Нажимая кнопку, вы подтверждаете, что ознакомились с <a href="policy.html">политикой конфиденциальности</a>, даете согласие на обработку своих персональных данных и соглашаетесь с <a href="offer.html">условиями использования</a>.</p>

		</div>
	</div>

	<div class="activity main is-hidden">

		<div class="container">

<style>

.header {
	display: flex;
	flex-flow: row;
	align-items: center;
	justify-content: space-between;
	width: 100%;
	min-height: 3rem;
}

.header .logo {
	font-size: 1.25rem;
}

.header .logo img {
	height: 2.5rem;
}

</style>

			<div class="header">

				<div class="logo horizontal">
			        <img src="images/logo.svg"/>
			        <div><span>VIRA</span><span>PAY</span></div>
				</div>

				<div class="profile-show">
					<img class="avatar"/>
					<span class="fullname">VIRAPAY</span>
				</div>

			</div>

<style>

.banner {
	border-radius: 10px;
	background-image: url(/images/banner-stub.jpg);
	background-size: cover;
	color: #fff;
	display: flex;
	flex-flow: column;
	align-items: center;
	justify-content: center;
	width: 100%;
	min-height: 8rem;
	margin-top: 2rem;
	cursor: pointer;
}

.banner > * {
	margin: 0;
}

</style>

			<a class="banner">
				<h3>Место для вашей рекламы</h3>
				<p>Не упустите ваш шанс!</p>
			</a>

			<div class="bottom-panel">
				<div class="hot-icons">
					<a class="open-favorites">
						<i class="icon mdi mdi-star-outline"></i>
						<span>Избранное</span>
					</a>
					<a class="open-scanner">
						<i class="icon mdi mdi-qrcode-scan"></i>
						<span>Сканнер</span>
					</a>
					<a class="open-history">
						<i class="icon mdi mdi-history"></i>
						<span>История</span>
					</a>
				</div>
			</div>

<!--
			<h5>Категории</h5>
			<div class="categories">
				<a class="category" data-id="4">
					<i class="icon mdi mdi-office-building"></i>
					<span>Коммунальные услуги</span>
				</a>
				<a class="category" data-id="1">
					<i class="icon mdi mdi-web"></i>
					<span>Интернет</span>
				</a>
				<a class="category" data-id="3">
					<i class="icon mdi mdi-television-classic"></i>
					<span>Телевидение</span>
				</a>
				<a class="category" data-id="7">
					<i class="icon mdi mdi-phone-in-talk"></i>
					<span>Телефон</span>
				</a>
				<a class="category" data-id="5">
					<i class="icon mdi mdi-gamepad-variant-outline"></i>
					<span>Игры</span>
				</a>
				<a class="category" data-id="8">
					<i class="icon mdi mdi-dots-horizontal"></i>
					<span>Прочее</span>
				</a>
			</div>
-->

			<!--<h5>Все услуги</h5>-->

<style>

.search-field {
	display: flex;
	flex-flow: row;
	align-items: center;
	justify-content: center;
	width: 100%;
    margin-top: 2rem;
    margin-bottom: 1rem;
}

.search-field .icon {
	width: 3rem;
	color: rgb(77, 144, 254);
	align-items: center;
	justify-content: center;
	display: flex;
	cursor: pointer;
	font-size: 1.8rem;

	height: 2.5rem;
    padding-left: 1rem;
    padding-right: 1rem;
    box-sizing: border-box;

	margin-right: -3rem;
	z-index: 1;
}

.search-field .label {
	width: 100%;
	display: flex;
	max-width: 100%;
}

.search-field .label div {
	width: 100%;
}

.search-field .label input {
	padding-left: 3rem;
	height: 3rem;
	font-size: 1.2rem;
	border: 1px solid rgb(77, 144, 254);
    box-shadow: 0 0 1rem rgba(0,0,0,0.1);
}

.search-field .label input:focus {
	border: 1px solid rgb(77, 144, 254);
	box-shadow: 0.05rem 0.15rem 0 rgba(77, 144, 254, 0.2);
}

#focus-trigger {
	background: transparent;
	color: transparent;
	width: 1rem;
	height: 0;
	outline: 0;
	box-shadow: none;
	border: 0;
	padding: 0;
	font-size: 0;
}

#focus-trigger:focus {
	border: 0;
	outline: 0;
	box-shadow: none;
	padding: 0;
}

#focus-trigger.hide {
	display: none;
}

</style>

			<div class="search-field">
				<i class="icon mdi mdi-magnify"></i>
				<label class="label">
					<div><input class="search" placeholder="Поиск по ИНН, Названию..."/></div>
				</label>
			</div>

		<div class="scroll-horizontal">
			<div class="categories">
				<a class="category" data-id="4">
					<i class="icon mdi mdi-office-building"></i>
					<span>Коммунальные услуги</span>
				</a>
				<a class="category" data-id="1">
					<i class="icon mdi mdi-web"></i>
					<span>Интернет</span>
				</a>
				<a class="category" data-id="3">
					<i class="icon mdi mdi-television-classic"></i>
					<span>Телевидение</span>
				</a>
				<a class="category" data-id="7">
					<i class="icon mdi mdi-phone-in-talk"></i>
					<span>Телефон</span>
				</a>
				<a class="category" data-id="5">
					<i class="icon mdi mdi-gamepad-variant-outline"></i>
					<span>Игры</span>
				</a>
				<a class="category" data-id="8">
					<i class="icon mdi mdi-dots-horizontal"></i>
					<span>Прочее</span>
				</a>
			</div>
		</div>

		<div class="partners">
<!--
				<div class="provider">
					<a class="icon mdi mdi-star-outline"></a>
					<div class="details">
						<div class="name">Промсвязьмонтаж ООО</div>
						<div class="service">Домофон</div>
					</div>
					<a class="icon mdi mdi-chevron-right"></a>
				</div>

				<div class="provider">
					<a class="icon mdi mdi-star-outline"></a>
					<div class="details">
						<div class="name">Промсвязьмонтаж ООО</div>
						<div class="service">Пени</div>
					</div>
					<a class="icon mdi mdi-chevron-right"></a>
				</div>

				<div class="provider">
					<a class="icon mdi mdi-star-outline"></a>
					<div class="details">
						<div class="name">Газпром межрегионгаз Иваново ООО</div>
						<div class="service">Оплата за ВГДО</div>
					</div>
					<a class="icon mdi mdi-chevron-right"></a>
				</div>
-->
			</div>

		</div>
	</div>

	<input type="text" id="focus-trigger" class="hide"/>

</body>
<script>

'use strict';

//throw 'LOCK';

let isLoggedInWith = {
	google: undefined,
	facebook: undefined,
	vk: undefined
}

function isLoggedIn() {
	if (isLoggedInWith.google === undefined
	 || isLoggedInWith.facebook === undefined
	 || isLoggedInWith.vk === undefined) {
		return undefined
	}
	return isLoggedInWith.google || isLoggedInWith.facebook || isLoggedInWith.vk
}

let profileData = null
let providersList = null
let profileSave = function () { }

function isLoggedOut() {
console.log('isLoggedOut()',isLoggedIn() === false)
	return isLoggedIn() === false
}

// activities

let activities = Array.from(document.querySelectorAll('.activity'))
let activityLoading = activities.reduce((_, a) => a.classList.contains('loading') ? a : _, null)
let activityMessage = activities.reduce((_, a) => a.classList.contains('message') ? a : _, null)
let activityLogin = activities.reduce((_, a) => a.classList.contains('login') ? a : _, null)
let activityProfile = activities.reduce((_, a) => a.classList.contains('profile') ? a : _, null)
let activityMain = activities.reduce((_, a) => a.classList.contains('main') ? a : _, null)
let activityNavBar = activities.reduce((_, a) => a.classList.contains('navbar') ? a : _, null)
let activityAccounts = activities.reduce((_, a) => a.classList.contains('accounts') ? a : _, null)
let activityAccountEdit = activities.reduce((_, a) => a.classList.contains('account-edit') ? a : _, null)
let activityAccountAdd = activities.reduce((_, a) => a.classList.contains('account-add') ? a : _, null)

// activities switcher

function switchActivity(activity) {
	activities.forEach(a => a.classList.add('is-hidden'))
	activity.classList.remove('is-hidden')
	document.scrollingElement.scrollTop = 0
}

// message

function showMessage(title, text, actionCallback) {
	activityMessage.querySelector('.title').innerText = title
	activityMessage.querySelector('.text').innerText = text
	activityMessage.querySelectorAll('.action').forEach(node => {
		node.onclick = function () {
			actionCallback();
		}
	})
	switchActivity(activityMessage)
}

// backend node

let backend = new JSONRPC2.RemoteProxyObject(
	// using JSON RPC over HTTP
	new JSONRPC2.Transports.HTTP(
		'https://virapay.herokuapp.com/rpc/json',
		 {
			mode: 'cors'
		 }
	)
)

let scrollByYTo = (function () {

//document.scrollingElement.scrollTop

	let t0 = Date.now()

	function frame(el) {
		let time = JSON.parse(el.dataset.scrollingTime)
		let t = Math.abs(Date.now() - t0) / time
		let sourceY = JSON.parse(el.dataset.scrollingSourceY)
		let targetY = JSON.parse(el.dataset.scrollingTargetY)
		if (t >= 1) {
			el.scrollTop = targetY
			el.dataset.scrollingProgress = JSON.stringify(false)
		} else {
			el.scrollTop = sourceY + (targetY - sourceY) * t
			requestAnimationFrame(function () { frame(el) })
		}
	}

	return function (el, y, time = 300) {

		t0 = Date.now()

		el.dataset.scrollingTime = JSON.stringify(time)
		el.dataset.scrollingSourceY = JSON.stringify(el.scrollTop)
		el.dataset.scrollingTargetY = JSON.stringify(y)
		if (el.dataset.scrollingProgress === undefined) {
			el.dataset.scrollingProgress = JSON.stringify(false)
		}
		let flag = JSON.parse(el.dataset.scrollingProgress)
		if (!flag) {
			el.dataset.scrollingProgress = JSON.stringify(true)
			frame(el)
		}

	}

})();

// main activity

let mainInited = false

async function mainInit() {

	if (mainInited === false) {

		switchActivity(activityLoading)

		let storageProvidersKey = `/${location.hostname}/providers`

		let data = storageGet(storageProvidersKey)
		let version = (data ? data.version : 0)
		let newData = await backend.providersGetUpdate(version)
		if (newData !== null) {
			data = newData
			storagePut(storageProvidersKey, data)
		}

		let listNode = activityMain.querySelector('.partners')
		listNode.innerHTML = ''
		providersList = data.providers
		providersList.forEach(item => {

			let rowKey = '' + item.id + '/' + (item.service_id ? item.service_id : 0)

			let providerNode = document.createElement('div')
			providerNode.classList.add('provider')
			providerNode.classList.add('show')

			let favNode = document.createElement('a')
			favNode.classList.add('icon')
			favNode.classList.add('mdi')
			favNode.classList.add('fav')
			if (profileData.favList.indexOf(rowKey) >= 0) {
				favNode.classList.add('mdi-star')
				favNode.classList.add('selected')
				item.isFavorite = true
			} else {
				favNode.classList.add('mdi-star-outline')
				item.isFavorite = false
			}

			let detailsNode = document.createElement('div')
			detailsNode.classList.add('details')

			let nameNode = document.createElement('div')
			nameNode.classList.add('name')
			nameNode.innerText = item.name_portal

			let innNode = document.createElement('div')
			innNode.classList.add('inn')
			innNode.innerText = 'ИНН ' + item.inn

			let serviceNode = document.createElement('div')
			serviceNode.classList.add('service')
			serviceNode.innerText = item.service_name

			let btnNode = document.createElement('a')
			btnNode.classList.add('icon')
			btnNode.classList.add('mdi')
			btnNode.classList.add('mdi-chevron-right')

			detailsNode.appendChild(nameNode)
			detailsNode.appendChild(innNode)
			detailsNode.appendChild(serviceNode)
			providerNode.appendChild(favNode)
			providerNode.appendChild(detailsNode)
			providerNode.appendChild(btnNode)
			providerNode.dataset.categories = JSON.stringify(item.categories === null ? [] : item.categories)
			listNode.appendChild(providerNode)

			favNode.onclick = function () {
				if (favNode.classList.contains('mdi-star-outline')) {
					favNode.classList.remove('mdi-star-outline')
					favNode.classList.add('mdi-star')
					favNode.classList.add('selected')
					profileData.favList.push(rowKey)
					item.isFavorite = true
				} else {
					favNode.classList.remove('selected')
					favNode.classList.remove('mdi-star')
					favNode.classList.add('mdi-star-outline')
					profileData.favList.splice(profileData.favList.indexOf(rowKey), 1)
					item.isFavorite = false
				}
				let result = profileSave()
				if (result) {
					filterProviders()
				} else {
					showMessage('Профиль пользователя', 'Не удалось сохранить данные. Попробуйте позднее.', () => {
						favNode.classList.remove('selected')
						favNode.classList.remove('mdi-star')
						favNode.classList.add('mdi-star-outline')
						profileData.favList.splice(profileData.favList.indexOf(rowKey), 1)
						item.isFavorite = false
					})
				}
			}

			let accountsList = activityAccounts.querySelector('.accounts-list')

			function accountsListUpdateTriggers() {

				let triggers = document.querySelectorAll('.popup-trigger')

				triggers.forEach((node, i) => {
					node.onclick = () => {
						triggers.forEach((node_, j) => {
							if (i != j) node_.classList.remove('is-active')
						})
						node.classList.toggle('is-active')
					}
				})

				document.querySelectorAll('.popup > a').forEach(a => a.onmousedown = () => {
					triggers.forEach(node => {
						node.classList.remove('is-active')
					})
				})

			}

			function addAccountNode(accItem) {

				let accountNode = document.createElement('div')
				accountNode.classList.add('account')

					let detailsNode = document.createElement('div')
					detailsNode.classList.add('details')

						let infoNode = document.createElement('div')
						infoNode.classList.add('info')

							let nameNode = document.createElement('div')
							nameNode.classList.add('name')
							nameNode.innerText = item.acc_name

							let valueNode = document.createElement('div')
							valueNode.classList.add('value')
							valueNode.innerText = accItem.acc

							let descriptionNode = document.createElement('div')
							descriptionNode.classList.add('description')
							descriptionNode.innerText = accItem.desc

						infoNode.appendChild(nameNode)
						infoNode.appendChild(valueNode)
						infoNode.appendChild(descriptionNode)

						let commandsNode = document.createElement('div')
						commandsNode.classList.add('commands')
						commandsNode.innerHTML = `
							<i class="icon mdi mdi-dots-vertical popup-trigger"></i>
							<div class="popup">
								<a class="account-delete">Удалить</a>
								<a class="account-edit">Изменить</a>
								<a class="account-payment">Перейти к оплате</a>
							</div>
						`

					detailsNode.appendChild(infoNode)
					detailsNode.appendChild(commandsNode)

				accountNode.appendChild(detailsNode)

				let buttonContainerNode = document.createElement('div')
				buttonContainerNode.classList.add('button-container')
				buttonContainerNode.innerHTML = `
					<button class="button">
			            <span>Перейти к оплате</span>
						<i class="icon mdi mdi-arrow-right"></i>
					</button>
				`

				accountNode.appendChild(buttonContainerNode)

				accountsList.appendChild(accountNode)

				accountsListUpdateTriggers()
			}

			function pick() {

				let scrollTopMain = document.scrollingElement.scrollTop
				activityAccounts.querySelectorAll('.back').forEach(node => node.onclick = () => {
					switchActivity(activityMain)
					document.scrollingElement.scrollTop = scrollTopMain
				})

				activityAccounts.querySelectorAll('.provider-details .name').forEach(node => {
					node.innerText = item.name_portal
				})
				activityAccounts.querySelectorAll('.provider-details .inn').forEach(node => {
					node.innerText = 'ИНН ' + item.inn
				})
				activityAccounts.querySelectorAll('.provider-details .service').forEach(node => {
					node.innerText = item.service_name
				})

				accountsList.innerHTML = ''
				if (profileData.accList[rowKey] instanceof Array) {
					profileData.accList[rowKey].forEach(accItem => addAccountNode(accItem))
				}
				activityAccounts.querySelectorAll('.acc-name').forEach(node => {
					node.innerText = item.acc_name
				})
				activityAccounts.querySelectorAll('.popup-trigger').forEach(node => {
					node.classList.remove('is-active')
				})

				let scrollTopAccounts = 0
				activityAccountEdit.querySelectorAll('.back').forEach(node => node.onclick = () => {
					switchActivity(activityAccounts)
					document.scrollingElement.scrollTop = scrollTopAccounts
				})

				activityAccountEdit.querySelectorAll('.provider-details .name').forEach(node => {
					node.innerText = item.name_portal
				})
				activityAccountEdit.querySelectorAll('.provider-details .inn').forEach(node => {
					node.innerText = 'ИНН ' + item.inn
				})
				activityAccountEdit.querySelectorAll('.provider-details .service').forEach(node => {
					node.innerText = item.service_name
				})

				activityAccountEdit.querySelectorAll('.acc-name').forEach(node => {
					node.innerText = item.acc_name
				})
				activityAccountEdit.querySelectorAll('.acc-description').forEach(node => {
					node.innerText = item.acc_description
				})
				activityAccountEdit.querySelectorAll('.acc-example').forEach(node => {
					node.innerText = item.acc_example
				})

				activityAccounts.querySelectorAll('.account-add').forEach(node => {

					let inputAccount = activityAccountEdit.querySelector('input.account')
					let inputDescription = activityAccountEdit.querySelector('input.description')

					node.onclick = () => {

						scrollTopAccounts = document.scrollingElement.scrollTop

						inputAccount.value = ''
						inputDescription.value = ''

						activityAccountEdit.querySelector('.account-save').onclick = () => {

							if (!(profileData.accList[rowKey] instanceof Array)) {
								profileData.accList[rowKey] = [ ]
							}
							let accItem = {
								acc: inputAccount.value,
								desc: inputDescription.value,
								sum: '0.00'
							}
							profileData.accList[rowKey].push(accItem)

							let result = profileSave()
							if (result) {
								addAccountNode(accItem)
								activityAccountEdit.querySelector('.back').onclick()
							} else {
								showMessage('Учетные данные', 'Не удалось сохранить данные. Попробуйте позднее.', () => {
									profileData.accList[rowKey].pop()
								})
							}							
						}

						switchActivity(activityAccountEdit)
					}
				})

				activityAccounts.querySelectorAll('.account').forEach(account => {
					account.querySelectorAll('.account-edit').forEach(node => {
						node.onclick = () => {
							scrollTopAccounts = document.scrollingElement.scrollTop
							activityAccountEdit.querySelector('.acc-description').innerText = item.acc_description
							activityAccountEdit.querySelector('.acc-example').innerText = item.acc_example
							activityAccountEdit.querySelector('input.account').value = account.querySelector('.value').innerText
							activityAccountEdit.querySelector('input.description').value = account.querySelector('.description').innerText
							activityAccountEdit.querySelector('.account-save').onclick = () => {
								account.querySelector('.value').innerText = activityAccountEdit.querySelector('input.account').value
								account.querySelector('.description').innerText = activityAccountEdit.querySelector('input.description').value
								activityAccountEdit.querySelector('.back').onclick()
							}
							// TODO update accItem
console.log('edit account', account)
							switchActivity(activityAccountEdit)
						}
					})
				})

				switchActivity(activityAccounts)
			}

			nameNode.onclick = pick
			serviceNode.onclick = pick
			btnNode.onclick = pick

			item.node = providerNode
		})

		mainInited = true
	}

	filterProviders()
	switchActivity(activityMain)
	setTimeout(function () {
		document.querySelector('.bottom-panel').classList.remove('hide')
	}, 750)
}

function filterProviders() {

	let favlistOnly = activityMain.querySelector('.open-favorites').classList.contains('selected')

	let selectedCategories = []

	activityMain.querySelectorAll('.category').forEach(category => {
		if (category.classList.contains('selected')) {
			selectedCategories.push(JSON.parse(category.dataset.id))
		}
	})

	let searchQuery = '' + document.querySelector('.search-field input').value
	let searchWords = searchQuery
		.toLowerCase()
		.replace(/[\,\.\?\!\%\*\(\)\[\]\{\}\-\+\_\<\>\:\;\"\'\`\\\/\r\n\t]+/g, ' ')
		.split(/\s+/)
		.filter(word => word.length > 0)
//console.log('searchWords', searchWords)


	let hiddenItems = []

	providersList.forEach(row => {

		row.isMatch = true

		if (searchWords.length > 0) {
			let found = true
			searchWords.forEach(word => {
				//if (row.search_key.indexOf(word) < 0) {
				if (!row.search_key.some(key => key.startsWith(word))) {
					found = false
				}
			})
			if (!found) {
				row.isMatch = false
			}
		}

		if (selectedCategories.length > 0) {
			let found = false
			let categories = row.categories
			selectedCategories.forEach(selectedCategory => {
				if (categories.indexOf(selectedCategory) >= 0) {
					found = true
				}
			})
			if (!found) {
				row.isMatch = false
			}
		}

		if (favlistOnly && !row.isFavorite) {
			row.isMatch = false
		}

		if (row.isMatch) {
			row.node.classList.add('show')
		} else {
			if (row.node.classList.contains('show')) {
				row.node.classList.remove('show')
				row.node.classList.add('hide')
				hiddenItems.push(row.node)
			}
		}

	})

	setTimeout(function () {
		hiddenItems.forEach(node => {
			node.style.marginBottom = '-' + node.offsetHeight + 'px'
		})
		setTimeout(function () {
			hiddenItems.forEach(node => {
				node.classList.remove('hide')
				node.style.marginBottom = '0'
			})
		}, 500)
	}, 0)
}

// profile functions

async function profileInit(apiName, id, fullName, imageUrl, email, token, doLogout, doUpdate) {

	let logoutCallback = function () {
		doLogout()
		profileData = null
		profileSave = function () { }
	}

	switchActivity(activityLoading)

	try {

		console.log('LOGIN REQUEST', apiName, id, token)

		let result = await backend.login(apiName, id, token, fullName, email, imageUrl)

		console.log('LOGIN RESULT', result)

		if (result) {

			if (!result.data) {
				result.data = { }
			}
			if (!(result.data.favList instanceof Array)) {
				result.data.favList = [ ]
			}
			if (typeof result.data.accList !== 'object') {
				result.data.accList = { }
			}
			profileData = result.data

			activityProfile.querySelector('.avatar').src = imageUrl
			activityProfile.querySelector('.apiname').innerText = apiName
			activityProfile.querySelector('.id').innerText = id
			activityProfile.querySelector('.fullname').value = result.name
			activityProfile.querySelector('.email').value = result.email
			activityProfile.querySelectorAll('.logout').forEach(node => {
				node.onclick = function () {
					logoutCallback();
				}
			})
			activityProfile.querySelectorAll('.back').forEach(node => {
				if (result.isNew) {
					node.onclick = function () {
						logoutCallback()
					}
				} else {
					node.onclick = function () {
						mainInit() //switchActivity(activityMain)
					}
				}
			})
			profileSave = async function () {
				try {
					let name = activityProfile.querySelector('.fullname').value
					let email = activityProfile.querySelector('.email').value
					let result = await backend.profileUpdate(
						apiName, id, token,
						name, email, imageUrl, profileData
					)
					if (result) {
						doUpdate(name, email)
					}
					return result
				} catch (errorProfileSaving) {
					console.log('SAVING PROFILE FAILED', errorProfileSaving)
					showMessage('Профиль пользователя', 'Не удалось сохранить данные. Попробуйте позднее.', () => switchActivity(activityProfile))
				}
				return null
			}
			activityProfile.querySelectorAll('.profile-save').forEach(node => {
				node.onclick = async function () {
					switchActivity(activityLoading)

					let result = profileSave()
					if (result) {
						let name = activityProfile.querySelector('.fullname').value
						activityMain.querySelector('.fullname').innerText = name
						activityProfile.querySelectorAll('.back').forEach(node => {
							node.onclick = function () {
								mainInit() //switchActivity(activityMain)
							}
						})
						mainInit() //switchActivity(activityMain)
					} else {
						showMessage('Профиль пользователя', 'Не удалось сохранить данные. Попробуйте позднее.', () => switchActivity(activityProfile))
					}


				}
			})
			activityMain.querySelector('.avatar').src = imageUrl
			activityMain.querySelector('.fullname').innerText = result.name

			document.querySelectorAll('.profile-show').forEach(node => {
				node.onclick = function () {
					switchActivity(activityProfile)
				}
			})
			activityMain.querySelectorAll('.profile-show').forEach(node => {
				node.onclick = function () {
					if (activityNavBar.classList.contains('is-hidden')) {
						navBarShow()
					} else {
						navBarHide()
					}
				}
			})


			if (result.isNew) {
				switchActivity(activityProfile)
			} else {
				mainInit() //switchActivity(activityMain)
			}

		} else {

			showMessage('Вход', 'Не удалось подтвердить токен пользователя. Попробуйте позднее.', logoutCallback)
		}

	} catch (errorLogin) {

		console.log('LOGIN FAILED', errorLogin)
		showMessage('Вход', 'Не удалось выпольнить вход в приложение. Попробуйте позднее.', logoutCallback)
	}

}

// focus

function leaveFocusedElement() {
	let el = document.querySelector('#focus-trigger')
	el.classList.remove('hide')
console.log('leave focused element')
	setTimeout(function () {
		el.focus()
		setTimeout(function () {
			el.classList.add('hide')
		}, 50)
	}, 50)
}

//

let navBarShow = () => { }
let navBarHide = () => { }

// common controls

(function () {

	activityMain.querySelectorAll('.category').forEach(category => {
		category.onclick = () => {
			category.classList.toggle('selected')
			filterProviders()
		}
	});

	(function () {
		let timeout = null
		let searchInput = activityMain.querySelector('.search-field input')
		searchInput.addEventListener('input', evt => {
			if (timeout !== null) {
				clearTimeout(timeout)
				timeout = null
			}
			timeout = setTimeout(function () {
				clearTimeout(timeout)
				timeout = null
				filterProviders()
			}, 500)
		})
		searchInput.addEventListener('keydown', evt => {
			if (evt.keyCode === 13) {
				evt.stopPropagation()
				evt.preventDefault()
				leaveFocusedElement()
				let el = document.querySelector('.search-field')
				scrollByYTo(document.scrollingElement, el.offsetTop - parseInt(getComputedStyle(el).marginTop))
			}
		})
		let focusTimeout = null
		searchInput.addEventListener('focusin', evt => {
			if (focusTimeout !== null) {
				clearTimeout(focusTimeout)
				focusTimeout = null
			}
			let el = document.querySelector('.search-field')
			scrollByYTo(document.scrollingElement, el.offsetTop - parseInt(getComputedStyle(el).marginTop))
			document.querySelector('.bottom-panel').classList.add('hide')
		})
		searchInput.addEventListener('focusout', evt => {
			if (focusTimeout !== null) {
				clearTimeout(focusTimeout)
				focusTimeout = null
			}
			focusTimeout = setTimeout(function () {
				document.querySelector('.bottom-panel').classList.remove('hide')
				focusTimeout = null
			}, 750)
		})
	})();

	activityMain.querySelectorAll('.open-favorites').forEach(btn => {
		btn.onclick = () => {
			let icon = btn.querySelector('.icon')
			if (icon.classList.contains('mdi-star-outline')) {
				icon.classList.remove('mdi-star-outline')
				icon.classList.add('mdi-star')
				btn.classList.add('selected')
				setTimeout(function () {
					let el = document.querySelector('.search-field')
					scrollByYTo(document.scrollingElement, el.offsetTop - parseInt(getComputedStyle(el).marginTop))
				}, 500)
			} else {
				btn.classList.remove('selected')
				icon.classList.remove('mdi-star')
				icon.classList.add('mdi-star-outline')
			}
			filterProviders()
		}
	})

	activityMain.querySelectorAll('.scroll-horizontal').forEach(el => {

		let drag = false
		let pt0 = null

		function touchStart(evt, pt) {
			pt0 = pt
			drag = true
//console.log('start', pt, evt.type)
		}

		function touchMove(evt, pt) {
			if (drag) {
//console.log('move', pt, evt.type)
				let dx = pt.x - pt0.x
				let dy = pt.y - pt0.y
				if (Math.abs(dx) > Math.abs(dy)) {
					el.scrollLeft -= dx
					pt0 = pt
					evt.stopPropagation()
					evt.preventDefault()
				}
			}
		}

		function touchEnd(evt, pt) {
			drag = false
//console.log('end', pt, evt.type)
		}

		el.addEventListener('mousedown', function (evt) {
			return touchStart(evt, { x: evt.pageX, y: evt.pageY })
		})

		el.addEventListener('touchstart', function (evt) {
			return touchStart(evt, { x: evt.touches[0].pageX, y: evt.touches[0].pageY })
		})

		el.addEventListener('mousemove', function (evt) {
			return touchMove(evt, { x: evt.pageX, y: evt.pageY })
		})

		el.addEventListener('touchmove', function (evt) {
			return touchMove(evt, { x: evt.touches[0].pageX, y: evt.touches[0].pageY })
		})

		document.addEventListener('mouseup', function (evt) {
			return touchEnd(evt, { x: evt.pageX, y: evt.pageY })
		})

		document.addEventListener('touchend', function (evt) {
			return touchEnd(evt, { x: evt.changedTouches[0].pageX, y: evt.changedTouches[0].pageY })
		})
	});

	(function () {

		let avatar = activityMain.querySelector('.avatar')
		let timerStep0 = null
		let timerStep1 = null

		function clearTimers() {
			if (timerStep0 !== null) {
				clearTimeout(timerStep0)
				timerStep0 = null
			}
			if (timerStep1 !== null) {
				clearTimeout(timerStep1)
				timerStep1 = null
			}
		}

		navBarShow = () => {
			let x = avatar.offsetLeft + avatar.offsetWidth/2
			let y = avatar.offsetTop + avatar.offsetHeight/2
			activityNavBar.style.clipPath = `circle(0% at ${x}px ${y}px)`
			activityNavBar.style.transition = 'clip-path 0.6s ease-out'
			activityNavBar.classList.remove('is-hidden')
			clearTimers()
			timerStep0 = setTimeout(() => {
				timerStep0 = null
				activityNavBar.style.clipPath = `circle(100% at ${x}px ${y}px)`
				document.querySelector('.bottom-panel').classList.add('hide')
				timerStep1 = setTimeout(() => {
					timerStep1 = null
					activityNavBar.style.clipPath = 'none'
					activityNavBar.style.transition = 'unset'
					activityNavBar.style.height = `${activityMain.offsetHeight}px`
				}, 600)
			}, 50)
		}

		navBarHide = () => {
			let x = avatar.offsetLeft + avatar.offsetWidth/2
			let y = avatar.offsetTop + avatar.offsetHeight/2
			document.scrollingElement.scrollTop = 0
			activityNavBar.style.height = 'auto'
			activityNavBar.style.clipPath = `circle(100% at ${x}px ${y}px)`
			activityNavBar.style.transition = 'clip-path 0.6s ease-out'
			clearTimers()
			timerStep0 = setTimeout(() => {
				timerStep0 = null
				activityNavBar.style.clipPath = `circle(0% at ${x}px ${y}px)`
				document.querySelector('.bottom-panel').classList.remove('hide')
				timerStep1 = setTimeout(() => {
					timerStep1 = null
					activityNavBar.style.clipPath = 'none'
					activityNavBar.style.transition = 'unset'
					activityNavBar.classList.add('is-hidden')
				}, 600)
			}, 50)
		}

		activityNavBar.querySelector('.back').onclick = function () {
			navBarHide()
		}

	})();

})();

// entry point

(function () {

	let sessionKey = `/${location.hostname}/session`
	let user = storageGet(sessionKey)
	if (user) {
		profileInit(user.apiName, user.id, user.name, user.picture, user.email, user.token, () => {
			storagePut(sessionKey, null)
			switchActivity(activityLogin)
			profileData = null
		}, (name, email) => {
			user.name = name
			user.email = email
			user.isNew = false
			storagePut(sessionKey, user)
		})
	} else {
		switchActivity(activityLogin)
	}

	console.log('VERSION', 108)

})();

</script>

	<!-- Auth -->
<!--	<script src="js/login/google.js" type="text/javascript" charset="utf-8" async="true" defer="true"></script>
	<script src="js/login/facebook.js" type="text/javascript" charset="utf-8" async="true" defer="true"></script>
	<script src="js/login/vk.js" type="text/javascript" charset="utf-8" async="true" defer="true"></script>-->

	<!-- DEBUG -->
<!--	<link href="css/debug/grid.css" rel="stylesheet"/>
	<script src="js/debug/grid.js" type="text/javascript" charset="utf-8"></script>-->

</html>